<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hockey Scorekeeper - Multiplayer</title>

  <!-- Firebase -->

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>

  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @keyframes sparkle {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.8; }
    }
    .sparkle { animation: sparkle 0.6s ease-in-out; }
  </style>

</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBFO04MS1hfTnE_ciPxTJCXO_Jk1w8DudY",
      authDomain: "hockey-scorekeeper.firebaseapp.com",
      databaseURL: "https://hockey-scorekeeper-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "hockey-scorekeeper",
      storageBucket: "hockey-scorekeeper.firebasestorage.app",
      messagingSenderId: "804304791634",
      appId: "1:804304791634:web:98532061d3768f6b8c178b"
    };

    let db = null;
    try {
      if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
      db = firebase.database();
    } catch (error) {
      console.log("Firebase not configured:", error);
    }

    const generateCode = () => {
      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      return Array(6).fill(0).map(() => chars[Math.floor(Math.random() * chars.length)]).join('');
    };

    const App = () => {
      const [screen, setScreen] = useState('start');
      const [matchCode, setMatchCode] = useState('');
      const [inputCode, setInputCode] = useState('');
      const [error, setError] = useState('');
      const [isMultiplayer, setIsMultiplayer] = useState(false);
      const [matchEnded, setMatchEnded] = useState(false);
      const [connectedUsers, setConnectedUsers] = useState(1);
      
      const [homeName, setHomeName] = useState('HOME TEAM');
      const [awayName, setAwayName] = useState('AWAY TEAM');
      const [currentPeriod, setCurrentPeriod] = useState(1);
      const [periodStats, setPeriodStats] = useState({
        1: { homeScore: 0, awayScore: 0, homeSaves: 0, awaySaves: 0 },
        2: { homeScore: 0, awayScore: 0, homeSaves: 0, awaySaves: 0 },
        3: { homeScore: 0, awayScore: 0, homeSaves: 0, awaySaves: 0 }
      });
      
      const matchRef = useRef(null);
      const userId = useRef(Math.random().toString(36).substr(2, 9));

      useEffect(() => {
        if (!isMultiplayer || !matchCode || !db) return;
        matchRef.current = db.ref(`matches/${matchCode}`);
        
        matchRef.current.on('value', (snap) => {
          const data = snap.val();
          if (data) {
            setPeriodStats(data.periodStats);
            setCurrentPeriod(data.currentPeriod);
            setHomeName(data.homeName);
            setAwayName(data.awayName);
            setMatchEnded(data.ended || false);
            if (data.users) setConnectedUsers(Object.keys(data.users).length);
          }
        });

        const userRef = matchRef.current.child(`users/${userId.current}`);
        userRef.set(true);
        userRef.onDisconnect().remove();

        return () => {
          if (matchRef.current) {
            matchRef.current.off();
            userRef.remove();
          }
        };
      }, [isMultiplayer, matchCode]);

      const createMatch = () => {
        setMatchCode(generateCode());
        setScreen('created');
      };

      const startMatch = () => {
        if (!db) { setError('Firebase not configured'); return; }
        db.ref(`matches/${matchCode}`).set({
          homeName, awayName, currentPeriod: 1, periodStats,
          ended: false, createdAt: Date.now(),
          users: { [userId.current]: true }
        }).then(() => {
          setIsMultiplayer(true);
          setScreen('game');
        });
      };

      const joinMatch = () => {
        if (!db) { setError('Firebase not configured'); return; }
        const code = inputCode.toUpperCase().trim();
        db.ref(`matches/${code}`).once('value').then((snap) => {
          if (snap.exists()) {
            const data = snap.val();
            if (data.ended) setError('Match already ended');
            else {
              setMatchCode(code);
              setIsMultiplayer(true);
              setScreen('game');
            }
          } else setError('Match not found');
        });
      };

      const updateStat = (team, stat, delta) => {
        const newStats = {
          ...periodStats,
          [currentPeriod]: {
            ...periodStats[currentPeriod],
            [team + stat]: Math.max(0, periodStats[currentPeriod][team + stat] + delta)
          }
        };
        setPeriodStats(newStats);
        if (isMultiplayer && matchRef.current && !matchEnded) {
          matchRef.current.update({ periodStats: newStats });
        }
      };

      const endMatch = () => {
        if (window.confirm('End match for all users?')) {
          if (matchRef.current) matchRef.current.update({ ended: true });
          setMatchEnded(true);
        }
      };

      const copyCode = () => {
        navigator.clipboard.writeText(matchCode).then(() => alert('Copied!'));
      };

      const totals = () => {
        let h = 0, a = 0;
        [1,2,3].forEach(p => { h += periodStats[p].homeScore; a += periodStats[p].awayScore; });
        return { homeScore: h, awayScore: a };
      };

      const t = totals();

      // START SCREEN
      if (screen === 'start') {
        return (
          <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100">
            <div className="max-w-md w-full p-6">
              <div className="bg-white rounded-2xl shadow-2xl p-8">
                <div className="text-center mb-8">
                  <div className="text-5xl mb-4">üèí</div>
                  <h1 className="text-3xl font-bold mb-2">Hockey Scorekeeper</h1>
                  <p className="text-gray-600">Track your game together</p>
                </div>
                {!db && <div className="bg-yellow-100 border border-yellow-400 text-yellow-800 px-4 py-3 rounded mb-6 text-sm">‚ö†Ô∏è Firebase not configured</div>}
                <div className="space-y-4">
                  <button onClick={() => setScreen('create')} disabled={!db} className="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg">CREATE NEW MATCH</button>
                  <button onClick={() => setScreen('join')} disabled={!db} className="w-full bg-gray-200 hover:bg-gray-300 py-4 rounded-xl font-bold text-lg shadow-lg">JOIN MATCH</button>
                  <button onClick={() => { setIsMultiplayer(false); setScreen('game'); }} className="w-full text-gray-500 hover:text-gray-700 py-2 text-sm">‚Üí Or continue alone</button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // CREATE SCREEN
      if (screen === 'create') {
        return (
          <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100">
            <div className="max-w-md w-full p-6">
              <div className="bg-white rounded-2xl shadow-2xl p-8">
                <button onClick={() => setScreen('start')} className="mb-6 text-gray-600">‚Üê Back</button>
                <h2 className="text-2xl font-bold mb-6">New Match</h2>
                <div className="space-y-4 mb-6">
                  <div>
                    <label className="block text-sm mb-2">Home Team</label>
                    <input type="text" value={homeName} onChange={(e) => setHomeName(e.target.value)} className="w-full px-4 py-3 border rounded-lg" />
                  </div>
                  <div>
                    <label className="block text-sm mb-2">Away Team</label>
                    <input type="text" value={awayName} onChange={(e) => setAwayName(e.target.value)} className="w-full px-4 py-3 border rounded-lg" />
                  </div>
                </div>
                <button onClick={createMatch} className="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg">START MATCH</button>
              </div>
            </div>
          </div>
        );
      }

      // CREATED SCREEN
      if (screen === 'created') {
        return (
          <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100">
            <div className="max-w-md w-full p-6">
              <div className="bg-white rounded-2xl shadow-2xl p-8">
                <div className="text-center mb-6">
                  <div className="text-5xl mb-4">‚úÖ</div>
                  <h2 className="text-2xl font-bold mb-2">Match Created!</h2>
                </div>
                <div className="bg-blue-50 rounded-xl p-6 mb-6">
                  <p className="text-sm text-gray-600 mb-3">Share this code:</p>
                  <div className="flex items-center gap-3">
                    <div className="flex-1 bg-white rounded-lg py-4 px-6 text-center">
                      <div className="text-3xl font-bold tracking-widest">{matchCode}</div>
                    </div>
                    <button onClick={copyCode} className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-4 rounded-lg font-semibold">Copy</button>
                  </div>
                </div>
                {error && <div className="bg-red-100 border border-red-400 text-red-800 px-4 py-3 rounded mb-4">{error}</div>}
                <button onClick={startMatch} className="w-full bg-green-600 hover:bg-green-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg">CONTINUE TO MATCH</button>
              </div>
            </div>
          </div>
        );
      }

      // JOIN SCREEN
      if (screen === 'join') {
        return (
          <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-blue-100">
            <div className="max-w-md w-full p-6">
              <div className="bg-white rounded-2xl shadow-2xl p-8">
                <button onClick={() => setScreen('start')} className="mb-6 text-gray-600">‚Üê Back</button>
                <h2 className="text-2xl font-bold mb-6">Join Match</h2>
                <div className="mb-6">
                  <label className="block text-sm mb-2">Enter match code:</label>
                  <input 
                    type="text" 
                    value={inputCode} 
                    onChange={(e) => { setInputCode(e.target.value.toUpperCase()); setError(''); }}
                    maxLength={6}
                    placeholder="ABC123"
                    className="w-full px-4 py-4 border rounded-lg text-center text-2xl font-bold tracking-widest"
                  />
                </div>
                {error && <div className="bg-red-100 border border-red-400 text-red-800 px-4 py-3 rounded mb-4 text-sm">{error}</div>}
                <button onClick={joinMatch} disabled={inputCode.length !== 6} className="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white py-4 rounded-xl font-bold text-lg shadow-lg">CONNECT</button>
              </div>
            </div>
          </div>
        );
      }

      // GAME SCREEN
      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100">
          <div className="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4 shadow-lg sticky top-0 z-50">
            <div className="max-w-6xl mx-auto">
              {isMultiplayer && (
                <div className="mb-3 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    {!matchEnded && <span className="flex items-center gap-2 bg-red-500 px-3 py-1 rounded-full text-sm font-bold"><span className="w-2 h-2 bg-white rounded-full animate-pulse"></span>LIVE</span>}
                    {matchEnded && <span className="bg-gray-500 px-3 py-1 rounded-full text-sm font-bold">MATCH ENDED</span>}
                    <span className="text-sm">üë• {connectedUsers} connected</span>
                  </div>
                  <button onClick={copyCode} className="bg-white bg-opacity-20 px-3 py-1 rounded font-mono font-bold">{matchCode} üìã</button>
                </div>
              )}
              
              <div className="flex justify-between items-center">
                <div className="flex gap-2 items-center">
                  <span className="text-sm font-medium">Period:</span>
                  {[1, 2, 3].map(p => (
                    <button 
                      key={p} 
                      onClick={() => {
                        setCurrentPeriod(p);
                        if (isMultiplayer && matchRef.current && !matchEnded) matchRef.current.update({ currentPeriod: p });
                      }}
                      disabled={matchEnded}
                      className={`px-3 py-1 rounded font-bold ${currentPeriod === p ? 'bg-yellow-400 text-blue-900' : 'bg-white bg-opacity-20'}`}
                    >
                      {p}
                    </button>
                  ))}
                </div>
                {isMultiplayer && !matchEnded && (
                  <button onClick={endMatch} className="bg-red-500 hover:bg-red-600 px-4 py-2 rounded font-semibold">End Match</button>
                )}
              </div>

              <div className="grid grid-cols-2 gap-4 mt-4">
                {[
                  { name: homeName, score: t.homeScore, team: 'home' },
                  { name: awayName, score: t.awayScore, team: 'away' }
                ].map((tm, idx) => (
                  <div key={idx} className="bg-white bg-opacity-10 rounded-lg p-3">
                    <div className="text-sm font-semibold mb-2">{tm.name}</div>
                    <div className="flex items-center justify-between">
                      <div className="text-3xl font-bold">{tm.score}</div>
                      <div className="flex gap-2">
                        <button onClick={() => updateStat(tm.team, 'Score', -1)} disabled={matchEnded} className="bg-red-500 bg-opacity-50 p-2 rounded">‚àí</button>
                        <button onClick={() => updateStat(tm.team, 'Score', 1)} disabled={matchEnded} className="bg-green-500 bg-opacity-50 p-2 rounded">+</button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>

          <div className="max-w-6xl mx-auto p-4">
            <div className="bg-white rounded-lg shadow p-6">
              <h2 className="text-2xl font-bold mb-4">Period Stats</h2>
              {[1, 2, 3].map(p => {
                const ps = periodStats[p];
                return (
                  <div key={p} className="bg-gray-50 rounded-lg p-4 mb-3">
                    <div className="flex justify-between items-center">
                      <h3 className="font-bold">Period {p}</h3>
                      {currentPeriod === p && <span className="bg-yellow-400 text-blue-900 px-2 py-1 rounded text-sm font-bold">Current</span>}
                    </div>
                    <div className="grid grid-cols-2 gap-4 mt-3">
                      <div className="bg-blue-50 rounded p-3">
                        <div className="font-semibold">{homeName}</div>
                        <div className="text-sm text-gray-700">Goals: {ps.homeScore}</div>
                        <div className="text-sm text-gray-700">Saves: {ps.homeSaves}</div>
                      </div>
                      <div className="bg-red-50 rounded p-3">
                        <div className="font-semibold">{awayName}</div>
                        <div className="text-sm text-gray-700">Goals: {ps.awayScore}</div>
                        <div className="text-sm text-gray-700">Saves: {ps.awaySaves}</div>
                      </div>
                    </div>
                  </div>
                );
              })}
              
              <div className="bg-gradient-to-r from-blue-600 to-blue-800 text-white rounded-lg p-6 mt-4">
                <h3 className="text-2xl font-bold text-center mb-4">FINAL</h3>
                <div className="flex justify-center gap-8 text-center">
                  <div><div className="text-sm mb-1">{homeName}</div><div className="text-5xl font-bold">{t.homeScore}</div></div>
                  <div className="text-3xl">-</div>
                  <div><div className="text-sm mb-1">{awayName}</div><div className="text-5xl font-bold">{t.awayScore}</div></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>

</body>
</html>
