<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hockey Scorekeeper</title>
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-39HWBJQ5Z1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-39HWBJQ5Z1');
  </script>
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes sparkle {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.8; }
    }
    .sparkle {
      animation: sparkle 0.6s ease-in-out;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBFO04MS1hfTnE_ciPxTJCXO_Jk1w8DudY",
      authDomain: "hockey-scorekeeper.firebaseapp.com",
      databaseURL: "https://hockey-scorekeeper-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "hockey-scorekeeper",
      storageBucket: "hockey-scorekeeper.firebasestorage.app",
      messagingSenderId: "804304791634",
      appId: "1:804304791634:web:98532061d3768f6b8c178b"
    };

    let db = null;
    try {
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      db = firebase.database();
    } catch (error) {
      console.log("Firebase error:", error);
    }

    const translations = {
      en: {
        homeTeam: 'HOME TEAM',
        awayTeam: 'AWAY TEAM',
        period: 'Period',
        settings: 'Settings',
        swapSides: 'Swap Sides',
        darkMode: 'Dark Mode',
        goals: 'Goals',
        byPeriod: 'By period',
        saves: 'Saves',
        shotsFor: 'Shots For',
        shotsAgainst: 'Shots Against',
        savePercent: 'Save %',
        resetAllStats: 'Reset All Stats',
        soundboard: 'Soundboard',
        periodStats: 'Period Stats',
        refereeSignals: 'Referee Signals',
        spotifyMode: 'Spotify Mode',
        goal: 'Goal',
        penalty: 'Penalty',
        stopAllSounds: 'Stop All Sounds',
        intro: 'Intro',
        final: 'FINAL',
        copyStats: 'Copy Stats',
        share: 'Share',
        gameInProgress: 'Game in Progress',
        continueOrStart: 'Continue or start fresh?',
        continue: 'Continue',
        startFresh: 'Start Fresh',
        resetConfirm: 'Reset all stats?',
        statsCopied: 'Stats copied!',
        copyFailed: 'Failed to copy',
        gameReport: 'Game Report',
        periodBreakdown: 'PERIOD BREAKDOWN',
        goalieStats: 'GOALIE STATS',
        shotsAgainstShort: 'shots against',
        clear: 'Clear',
        language: 'Language',
        closeFocus: 'Close Focus Mode',
        spotifyPlaylistUrl: 'Spotify Playlist URL',
        restore: 'Restore',
        focusMode: 'Focus Mode',
        keepScreenOn: 'Keep Screen On',
        createMatch: 'CREATE NEW MATCH',
        joinMatch: 'JOIN MATCH',
        continueAlone: 'Or continue alone',
        newMatch: 'New Match',
        startMatch: 'START MATCH',
        matchCreated: 'Match Created!',
        shareCode: 'Share this code:',
        copy: 'Copy',
        continueToMatch: 'CONTINUE TO MATCH',
        enterCode: 'Enter match code:',
        connect: 'CONNECT',
        matchCode: 'Match Code',
        connected: 'connected',
        liveMatch: 'LIVE',
        endMatch: 'End Match',
        endMatchConfirm: 'End match for all users?',
        matchEnded: 'MATCH ENDED',
        startNewMatch: 'Start New Match',
        matchNotFound: 'No match found with that code',
        matchAlreadyEnded: 'This match has already ended',
        goBack: 'Go Back',
        reconnectPrompt: 'Reconnect to match',
        reconnect: 'Reconnect',
        startNew: 'Start New'
      },
      sv: {
        homeTeam: 'HEMMALAG',
        awayTeam: 'BORTALAG',
        period: 'Period',
        settings: 'Inst√§llningar',
        swapSides: 'Byt Sidor',
        darkMode: 'M√∂rkt L√§ge',
        goals: 'M√•l',
        byPeriod: 'Per period',
        saves: 'R√§ddningar',
        shotsFor: 'Skott F√∂r',
        shotsAgainst: 'Skott Mot',
        savePercent: 'R√§ddnings %',
        resetAllStats: 'Nollst√§ll All Statistik',
        soundboard: 'Ljudpanel',
        periodStats: 'Periodstatistik',
        refereeSignals: 'Domarsignaler',
        spotifyMode: 'Spotify-l√§ge',
        goal: 'M√•l',
        penalty: 'Utvisning',
        stopAllSounds: 'Stoppa Alla Ljud',
        intro: 'Intro',
        final: 'SLUTRESULTAT',
        copyStats: 'Kopiera Statistik',
        share: 'Dela',
        gameInProgress: 'Match P√•g√•r',
        continueOrStart: 'Forts√§tt eller b√∂rja om?',
        continue: 'Forts√§tt',
        startFresh: 'B√∂rja Om',
        resetConfirm: 'Nollst√§ll all statistik?',
        statsCopied: 'Statistik kopierad!',
        copyFailed: 'Misslyckades kopiera',
        gameReport: 'Matchrapport',
        periodBreakdown: 'PERIODSAMMANFATTNING',
        goalieStats: 'M√ÖLVAKTSSTATISTIK',
        shotsAgainstShort: 'skott mot',
        clear: 'Rensa',
        language: 'Spr√•k',
        closeFocus: 'St√§ng Fokusl√§ge',
        spotifyPlaylistUrl: 'Spotify Spellista URL',
        restore: '√Öterst√§ll',
        focusMode: 'Fokusl√§ge',
        keepScreenOn: 'H√•ll Sk√§rmen P√•',
        createMatch: 'SKAPA NY MATCH',
        joinMatch: 'G√Ö MED I MATCH',
        continueAlone: 'Eller forts√§tt ensam',
        newMatch: 'Ny Match',
        startMatch: 'STARTA MATCH',
        matchCreated: 'Match Skapad!',
        shareCode: 'Dela denna kod:',
        copy: 'Kopiera',
        continueToMatch: 'FORTS√ÑTT TILL MATCH',
        enterCode: 'Ange matchkod:',
        connect: 'ANSLUT',
        matchCode: 'Matchkod',
        connected: 'anslutna',
        liveMatch: 'LIVE',
        endMatch: 'Avsluta Match',
        endMatchConfirm: 'Avsluta matchen f√∂r alla anv√§ndare?',
        matchEnded: 'MATCH AVSLUTAD',
        startNewMatch: 'Starta Ny Match',
        matchNotFound: 'Ingen match hittades med den koden',
        matchAlreadyEnded: 'Denna match √§r redan avslutad',
        goBack: 'G√• Tillbaka',
        reconnectPrompt: '√Öteranslut till match',
        reconnect: '√Öteranslut',
        startNew: 'Starta Ny'
      }
    };

    const generateMatchCode = () => {
      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      let code = '';
      for (let i = 0; i < 6; i++) {
        code += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return code;
    };
    const JuniorLeagueApp = () => {
      const [activeTab, setActiveTab] = useState('soundboard');
      const [currentPeriod, setCurrentPeriod] = useState(1);
      const [homeName, setHomeName] = useState('HOME TEAM');
      const [awayName, setAwayName] = useState('AWAY TEAM');
      const [sidesSwapped, setSidesSwapped] = useState(false);
      const [showSettings, setShowSettings] = useState(false);
      const [useSpotify, setUseSpotify] = useState(false);
      const [showRestorePrompt, setShowRestorePrompt] = useState(false);
      const [darkMode, setDarkMode] = useState(false);
      const [statsCollapsed, setStatsCollapsed] = useState(false);
      const [focusMode, setFocusMode] = useState(null);
      const [language, setLanguage] = useState('en');
      const [spotifyLoaded, setSpotifyLoaded] = useState(false);
      const [spotifyLoading, setSpotifyLoading] = useState(false);
      const [spotifyPlaylist, setSpotifyPlaylist] = useState('https://open.spotify.com/playlist/3HunXm4QT4dxcOz6eAljak?si=mKiXLeNMQM6ioJivpWP-EQ&pi=lAZXLD_QSPmpq');
      const [keepScreenOn, setKeepScreenOn] = useState(false);
      const [wakeLock, setWakeLock] = useState(null);
      
      // Multiplayer states
      const [screen, setScreen] = useState('start');
      const [matchCode, setMatchCode] = useState('');
      const [inputCode, setInputCode] = useState('');
      const [connectedUsers, setConnectedUsers] = useState(1);
      const [isMultiplayer, setIsMultiplayer] = useState(false);
      const [matchEnded, setMatchEnded] = useState(false);
      const [sparkleStats, setSparkleStats] = useState({});
      const [error, setError] = useState('');
      const [showReconnectPrompt, setShowReconnectPrompt] = useState(false);
      const [savedMatchCode, setSavedMatchCode] = useState('');
      
      const [periodStats, setPeriodStats] = useState({
        1: { homeScore: 0, awayScore: 0, homeSaves: 0, awaySaves: 0 },
        2: { homeScore: 0, awayScore: 0, homeSaves: 0, awaySaves: 0 },
        3: { homeScore: 0, awayScore: 0, homeSaves: 0, awaySaves: 0 }
      });
      
      const audioRefs = {
        homeGoal: useRef(null),
        awayGoal: useRef(null),
        homePenalty: useRef(null),
        awayPenalty: useRef(null),
        intro: useRef(null)
      };

      const [introPlaying, setIntroPlaying] = useState(false);
      const matchRef = useRef(null);
      const userIdRef = useRef(Math.random().toString(36).substr(2, 9));

      const t = translations[language];

      // Load preferences and check for saved match
      useEffect(() => {
        const savedDarkMode = localStorage.getItem('darkMode');
        if (savedDarkMode) setDarkMode(JSON.parse(savedDarkMode));
        
        const savedLanguage = localStorage.getItem('language');
        if (savedLanguage) setLanguage(savedLanguage);
        
        const savedSpotifyPlaylist = localStorage.getItem('spotifyPlaylist');
        if (savedSpotifyPlaylist) setSpotifyPlaylist(savedSpotifyPlaylist);
        
        const savedStatsCollapsed = localStorage.getItem('statsCollapsed');
        if (savedStatsCollapsed) setStatsCollapsed(JSON.parse(savedStatsCollapsed));
        
        const savedKeepScreenOn = localStorage.getItem('keepScreenOn');
        if (savedKeepScreenOn) setKeepScreenOn(JSON.parse(savedKeepScreenOn));
        
        const savedFocusMode = localStorage.getItem('focusMode');
        if (savedFocusMode) setFocusMode(savedFocusMode === 'null' ? null : savedFocusMode);

        // Check for saved multiplayer match
        const savedMatch = localStorage.getItem('multiplayerMatch');
        if (savedMatch) {
          const matchData = JSON.parse(savedMatch);
          setSavedMatchCode(matchData.code);
          setShowReconnectPrompt(true);
        }

        // Load solo game if no multiplayer
        if (!savedMatch) {
          const saved = localStorage.getItem('juniorLeagueGame');
          if (saved) {
            const gs = JSON.parse(saved);
            setCurrentPeriod(gs.currentPeriod);
            setHomeName(gs.homeName);
            setAwayName(gs.awayName);
            setSidesSwapped(gs.sidesSwapped);
            setPeriodStats(gs.periodStats);
          }
        }
      }, []);

      useEffect(() => { localStorage.setItem('darkMode', JSON.stringify(darkMode)); }, [darkMode]);
      useEffect(() => { localStorage.setItem('language', language); }, [language]);
      useEffect(() => { localStorage.setItem('spotifyPlaylist', spotifyPlaylist); }, [spotifyPlaylist]);
      useEffect(() => { localStorage.setItem('statsCollapsed', JSON.stringify(statsCollapsed)); }, [statsCollapsed]);
      useEffect(() => { localStorage.setItem('keepScreenOn', JSON.stringify(keepScreenOn)); }, [keepScreenOn]);
      useEffect(() => { localStorage.setItem('focusMode', focusMode); }, [focusMode]);

      // Save solo game to localStorage (only if not multiplayer)
      useEffect(() => {
        if (!isMultiplayer && screen === 'game') {
          const gameState = { currentPeriod, homeName, awayName, sidesSwapped, periodStats, timestamp: new Date().toISOString() };
          localStorage.setItem('juniorLeagueGame', JSON.stringify(gameState));
        }
      }, [currentPeriod, homeName, awayName, sidesSwapped, periodStats, isMultiplayer, screen]);

      // Wake Lock effect
      useEffect(() => {
        const requestWakeLock = async () => {
          try {
            if ('wakeLock' in navigator && keepScreenOn) {
              const lock = await navigator.wakeLock.request('screen');
              setWakeLock(lock);
            }
          } catch (err) {}
        };

        const releaseWakeLock = async () => {
          if (wakeLock) {
            try {
              await wakeLock.release();
              setWakeLock(null);
            } catch (err) {}
          }
        };

        if (keepScreenOn) requestWakeLock();
        else releaseWakeLock();

        const handleVisibilityChange = () => {
          if (keepScreenOn && document.visibilityState === 'visible') {
            requestWakeLock();
          }
        };

        document.addEventListener('visibilitychange', handleVisibilityChange);

        return () => {
          releaseWakeLock();
          document.removeEventListener('visibilitychange', handleVisibilityChange);
        };
      }, [keepScreenOn]);

      // Firebase sync effect
      useEffect(() => {
        if (!isMultiplayer || !matchCode || !db) return;

        matchRef.current = db.ref(`matches/${matchCode}`);
        
        matchRef.current.on('value', (snapshot) => {
          const data = snapshot.val();
          if (data) {
            setPeriodStats(data.periodStats);
            setCurrentPeriod(data.currentPeriod);
            setHomeName(data.homeName);
            setAwayName(data.awayName);
            setSidesSwapped(data.sidesSwapped);
            setMatchEnded(data.ended || false);
            
            if (data.users) {
              setConnectedUsers(Object.keys(data.users).length);
            }
          }
        });

        const userRef = matchRef.current.child(`users/${userIdRef.current}`);
        userRef.set(true);
        userRef.onDisconnect().remove();

        // Save match code for reconnection
        localStorage.setItem('multiplayerMatch', JSON.stringify({ code: matchCode, timestamp: Date.now() }));

        return () => {
          if (matchRef.current) {
            matchRef.current.off();
            userRef.remove();
          }
        };
      }, [isMultiplayer, matchCode]);

      const reconnectToMatch = () => {
        setMatchCode(savedMatchCode);
        setIsMultiplayer(true);
        setScreen('game');
        setShowReconnectPrompt(false);
      };

      const startNewSession = () => {
        localStorage.removeItem('multiplayerMatch');
        setShowReconnectPrompt(false);
      };

      const createMatch = () => {
        const code = generateMatchCode();
        setMatchCode(code);
        setScreen('created');
      };

      const startMultiplayerMatch = () => {
        if (!db) {
          setError('Firebase not configured');
          return;
        }

        const matchData = {
          homeName,
          awayName,
          currentPeriod: 1,
          sidesSwapped: false,
          periodStats: {
            1: { homeScore: 0, awayScore: 0, homeSaves: 0, awaySaves: 0 },
            2: { homeScore: 0, awayScore: 0, homeSaves: 0, awaySaves: 0 },
            3: { homeScore: 0, awayScore: 0, homeSaves: 0, awaySaves: 0 }
          },
          ended: false,
          createdAt: Date.now(),
          users: {
            [userIdRef.current]: true
          }
        };

        db.ref(`matches/${matchCode}`).set(matchData).then(() => {
          setIsMultiplayer(true);
          setScreen('game');
          localStorage.removeItem('juniorLeagueGame'); // Clear solo game
        }).catch(err => {
          setError('Failed to create match: ' + err.message);
        });
      };

      const joinMatch = () => {
        if (!db) {
          setError('Firebase not configured');
          return;
        }

        const code = inputCode.toUpperCase().trim();
        if (code.length !== 6) {
          setError('Invalid code length');
          return;
        }

        db.ref(`matches/${code}`).once('value').then((snapshot) => {
          if (snapshot.exists()) {
            const data = snapshot.val();
            if (data.ended) {
              setError(t.matchAlreadyEnded);
            } else {
              setMatchCode(code);
              setIsMultiplayer(true);
              setScreen('game');
              localStorage.removeItem('juniorLeagueGame'); // Clear solo game
            }
          } else {
            setError(t.matchNotFound);
          }
        }).catch(err => {
          setError('Failed to join match: ' + err.message);
        });
      };

      const continueAlone = () => {
        setIsMultiplayer(false);
        setScreen('game');
        localStorage.removeItem('multiplayerMatch');
      };

      const endMatch = () => {
        if (window.confirm(t.endMatchConfirm)) {
          if (matchRef.current) {
            matchRef.current.update({ ended: true });
          }
          setMatchEnded(true);
        }
      };

      const leaveMultiplayerMatch = () => {
        if (window.confirm('Leave multiplayer match?')) {
          localStorage.removeItem('multiplayerMatch');
          setIsMultiplayer(false);
          setMatchCode('');
          setScreen('start');
        }
      };

      const updateStat = (team, stat, delta) => {
        const newStats = {
          ...periodStats,
          [currentPeriod]: {
            ...periodStats[currentPeriod],
            [team + stat]: Math.max(0, periodStats[currentPeriod][team + stat] + delta)
          }
        };

        setPeriodStats(newStats);

        const key = `${team}${stat}${currentPeriod}`;
        setSparkleStats(prev => ({ ...prev, [key]: true }));
        setTimeout(() => {
          setSparkleStats(prev => ({ ...prev, [key]: false }));
        }, 600);

        if (isMultiplayer && matchRef.current && !matchEnded) {
          matchRef.current.update({ periodStats: newStats });
        }
      };

      const playSound = (soundType) => {
        if (useSpotify) { alert('Spotify: Would play ' + soundType); return; }
        const audio = audioRefs[soundType].current;
        if (audio) { 
          audio.currentTime = 0; 
          audio.play().catch(e => console.log('Play failed:', e)); 
        }
      };

      const toggleIntro = () => {
        const audio = audioRefs.intro.current;
        if (!audio) return;
        
        if (introPlaying) {
          audio.pause();
          audio.currentTime = 0;
          setIntroPlaying(false);
        } else {
          audio.loop = true;
          audio.play().catch(e => console.log('Play failed:', e));
          setIntroPlaying(true);
        }
      };

      const stopAllSounds = () => {
        Object.values(audioRefs).forEach(ref => { 
          if (ref.current) { 
            ref.current.pause(); 
            ref.current.currentTime = 0; 
          } 
        });
        setIntroPlaying(false);
      };

      const resetCounters = () => {
        if (window.confirm(t.resetConfirm)) {
          const newStats = { 
            1: { homeScore: 0, awayScore: 0, homeSaves: 0, awaySaves: 0 }, 
            2: { homeScore: 0, awayScore: 0, homeSaves: 0, awaySaves: 0 }, 
            3: { homeScore: 0, awayScore: 0, homeSaves: 0, awaySaves: 0 } 
          };
          setPeriodStats(newStats);
          setCurrentPeriod(1);
          
          if (isMultiplayer && matchRef.current && !matchEnded) {
            matchRef.current.update({ periodStats: newStats, currentPeriod: 1 });
          } else {
            localStorage.removeItem('juniorLeagueGame');
          }
        }
      };

      const calculateTotals = () => {
        let homeScore = 0, awayScore = 0, homeSaves = 0, awaySaves = 0;
        [1, 2, 3].forEach(p => {
          homeScore += periodStats[p].homeScore;
          awayScore += periodStats[p].awayScore;
          homeSaves += periodStats[p].homeSaves;
          awaySaves += periodStats[p].awaySaves;
        });
        return { homeScore, awayScore, homeSaves, awaySaves };
      };

      const totals = calculateTotals();

      const calcSP = (saves, goals) => {
        const shots = saves + goals;
        return shots === 0 ? '0.0' : ((saves / shots) * 100).toFixed(1);
      };

      const generateGameReport = () => {
        const date = new Date().toLocaleDateString();
        let r = `${t.gameReport} - ${date}\n${homeName} ${totals.homeScore} - ${totals.awayScore} ${awayName}\n\n${t.periodBreakdown}:\n`;
        [1, 2, 3].forEach(p => { 
          const ps = periodStats[p]; 
          r += `${t.period} ${p}: ${homeName} ${ps.homeScore}-${ps.awayScore} ${awayName}\n`; 
        });
        r += `\n${t.goalieStats}:\n${homeName}: ${totals.homeSaves} ${t.saves.toLowerCase()}, ${totals.homeSaves + totals.awayScore} ${t.shotsAgainstShort}, ${calcSP(totals.homeSaves, totals.awayScore)}%\n`;
        r += `${awayName}: ${totals.awaySaves} ${t.saves.toLowerCase()}, ${totals.awaySaves + totals.homeScore} ${t.shotsAgainstShort}, ${calcSP(totals.awaySaves, totals.homeScore)}%\n`;
        return r;
      };

      const copyStats = () => {
        navigator.clipboard.writeText(generateGameReport()).then(() => alert(t.statsCopied)).catch(() => alert(t.copyFailed));
      };

      const copyMatchCode = () => {
        navigator.clipboard.writeText(matchCode).then(() => alert(t.statsCopied)).catch(() => alert(t.copyFailed));
      };

      const shareStats = () => {
        if (navigator.share) navigator.share({ title: t.gameReport, text: generateGameReport() }).catch(() => copyStats());
        else copyStats();
      };

      const getSpotifyEmbedUrl = (url) => {
        const match = url.match(/playlist\/([a-zA-Z0-9]+)/);
        if (match && match[1]) {
          return `https://open.spotify.com/embed/playlist/${match[1]}?utm_source=generator&theme=0`;
        }
        return null;
      };

      const handleLoadSpotify = () => {
        setSpotifyLoading(true);
        setTimeout(() => {
          setSpotifyLoaded(true);
          setSpotifyLoading(false);
        }, 100);
      };

      const refSigs = [
        { name: 'Offside', description: language === 'en' ? 'Arm raised straight up' : 'Arm rakt upp', color: 'bg-yellow-100' },
        { name: 'Tripping', description: language === 'en' ? 'Strike leg with hand' : 'Sl√• benet med handen', color: 'bg-orange-100' },
        { name: 'Holding', description: language === 'en' ? 'Clasping wrist' : 'H√•lla handleden', color: 'bg-orange-100' },
        { name: 'High Sticking', description: language === 'en' ? 'Two hands held high' : 'Tv√• h√§nder h√∂gt upp', color: 'bg-red-100' },
        { name: 'Slashing', description: language === 'en' ? 'Chopping motion' : 'Huggande r√∂relse', color: 'bg-orange-100' },
        { name: 'Icing', description: language === 'en' ? 'Arms crossed at chest' : 'Armar korsade vid br√∂stet', color: 'bg-blue-100' },
        { name: language === 'en' ? 'Goal' : 'M√•l', description: language === 'en' ? 'Both arms pointed at goal' : 'B√•da armarna mot m√•let', color: 'bg-green-100' },
        { name: language === 'en' ? 'No Goal' : 'Inget M√•l', description: language === 'en' ? 'Arms crossed overhead' : 'Armar korsade √∂ver huvudet', color: 'bg-red-100' },
        { name: 'Time Out', description: language === 'en' ? 'Hands forming T' : 'H√§nder formar T', color: 'bg-gray-100' },
        { name: language === 'en' ? 'Penalty Shot' : 'Straff', description: language === 'en' ? 'Arms crossed then pointed' : 'Armar korsade sedan pekande', color: 'bg-purple-100' }
      ];

      // RECONNECT PROMPT
      if (showReconnectPrompt) {
        return (
          <div className={`min-h-screen flex items-center justify-center ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-blue-50 to-blue-100'}`}>
            <div className="max-w-md w-full p-6">
              <div className={`${darkMode ? 'bg-gray-800 text-white' : 'bg-white'} rounded-2xl shadow-2xl p-8`}>
                <h3 className="text-xl font-bold mb-3">{t.reconnectPrompt}</h3>
                <p className={`${darkMode ? 'text-gray-300' : 'text-gray-600'} mb-6`}>
                  {t.matchCode}: <span className="font-mono font-bold">{savedMatchCode}</span>
                </p>
                <div className="flex gap-3">
                  <button onClick={reconnectToMatch} className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold">{t.reconnect}</button>
                  <button onClick={startNewSession} className={`flex-1 ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'} py-3 rounded-lg font-semibold`}>{t.startNew}</button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // START SCREEN
      if (screen === 'start') {
        return (
          <div className={`min-h-screen flex items-center justify-center ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-blue-50 to-blue-100'}`}>
            <div className="max-w-md w-full p-6">
              <div className={`${darkMode ? 'bg-gray-800 text-white' : 'bg-white'} rounded-2xl shadow-2xl p-8`}>
                <div className="text-center mb-8">
                  <div className="text-5xl mb-4">üèí</div>
                  <h1 className="text-3xl font-bold mb-2">Hockey Scorekeeper</h1>
                  <p className={`${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                    {language === 'en' ? 'Track your game together' : 'F√∂lj matchen tillsammans'}
                  </p>
                </div>

                <div className="space-y-4">
                  <button 
                    onClick={() => setScreen('create')} 
                    className="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg transition"
                  >
                    {t.createMatch}
                  </button>
                  
                  <button 
                    onClick={() => setScreen('join')} 
                    className={`w-full ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'} py-4 rounded-xl font-bold text-lg shadow-lg transition`}
                  >
                    {t.joinMatch}
                  </button>

                  <button 
                    onClick={continueAlone} 
                    className={`w-full ${darkMode ? 'text-gray-400 hover:text-gray-300' : 'text-gray-500 hover:text-gray-700'} py-2 text-sm`}
                  >
                    ‚Üí {t.continueAlone}
                  </button>
                </div>

                <div className="mt-6 text-center">
                  <button 
                    onClick={() => setLanguage(language === 'en' ? 'sv' : 'en')}
                    className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}
                  >
                    {language === 'en' ? 'üá∏üá™ Svenska' : 'üá¨üáß English'}
                  </button>
                  <span className="mx-2">|</span>
                  <button 
                    onClick={() => setDarkMode(!darkMode)}
                    className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}
                  >
                    {darkMode ? '‚òÄÔ∏è' : 'üåô'}
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // CREATE MATCH SCREEN
      if (screen === 'create') {
        return (
          <div className={`min-h-screen flex items-center justify-center ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-blue-50 to-blue-100'}`}>
            <div className="max-w-md w-full p-6">
              <div className={`${darkMode ? 'bg-gray-800 text-white' : 'bg-white'} rounded-2xl shadow-2xl p-8`}>
                <button 
                  onClick={() => setScreen('start')} 
                  className={`mb-6 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}
                >
                  ‚Üê {t.goBack}
                </button>

                <h2 className="text-2xl font-bold mb-6">{t.newMatch}</h2>

                <div className="space-y-4 mb-6">
                  <div>
                    <label className="block text-sm mb-2">{t.homeTeam}</label>
                    <input 
                      type="text" 
                      value={homeName} 
                      onChange={(e) => setHomeName(e.target.value)} 
                      className={`w-full px-4 py-3 border rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}
                    />
                  </div>

                  <div>
                    <label className="block text-sm mb-2">{t.awayTeam}</label>
                    <input 
                      type="text" 
                      value={awayName} 
                      onChange={(e) => setAwayName(e.target.value)} 
                      className={`w-full px-4 py-3 border rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}
                    />
                  </div>
                </div>

                <button onClick={createMatch} className="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg">{t.startMatch}</button>
              </div>
            </div>
          </div>
        );
      }

      // CREATED SCREEN
      if (screen === 'created') {
        return (
          <div className={`min-h-screen flex items-center justify-center ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-blue-50 to-blue-100'}`}>
            <div className="max-w-md w-full p-6">
              <div className={`${darkMode ? 'bg-gray-800 text-white' : 'bg-white'} rounded-2xl shadow-2xl p-8`}>
                <div className="text-center mb-6">
                  <div className="text-5xl mb-4">‚úÖ</div>
                  <h2 className="text-2xl font-bold mb-2">{t.matchCreated}</h2>
                </div>

                <div className={`${darkMode ? 'bg-gray-700' : 'bg-blue-50'} rounded-xl p-6 mb-6`}>
                  <p className={`text-sm mb-3 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>{t.shareCode}</p>
                  <div className="flex items-center gap-3">
                    <div className="flex-1 bg-white dark:bg-gray-800 rounded-lg py-4 px-6 text-center">
                      <div className="text-3xl font-bold tracking-widest">{matchCode}</div>
                    </div>
                    <button 
                      onClick={copyMatchCode}
                      className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-4 rounded-lg font-semibold"
                    >
                      {t.copy}
                    </button>
                  </div>
                </div>

                {error && (
                  <div className="bg-red-100 border border-red-400 text-red-800 px-4 py-3 rounded mb-4">
                    {error}
                  </div>
                )}

                <button 
                  onClick={startMultiplayerMatch} 
                  className="w-full bg-green-600 hover:bg-green-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg"
                >
                  {t.continueToMatch}
                </button>

                <button 
                  onClick={() => setScreen('start')}
                  className={`w-full mt-3 ${darkMode ? 'text-gray-400' : 'text-gray-600'} py-2`}
                >
                  {t.goBack}
                </button>
              </div>
            </div>
          </div>
        );
      }

      // JOIN MATCH SCREEN
      if (screen === 'join') {
        return (
          <div className={`min-h-screen flex items-center justify-center ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-blue-50 to-blue-100'}`}>
            <div className="max-w-md w-full p-6">
              <div className={`${darkMode ? 'bg-gray-800 text-white' : 'bg-white'} rounded-2xl shadow-2xl p-8`}>
                <button 
                  onClick={() => setScreen('start')} 
                  className={`mb-6 ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}
                >
                  ‚Üê {t.goBack}
                </button>

                <h2 className="text-2xl font-bold mb-6">{t.joinMatch}</h2>

                <div className="mb-6">
                  <label className="block text-sm mb-2">{t.enterCode}</label>
                  <input 
                    type="text" 
                    value={inputCode} 
                    onChange={(e) => {
                      setInputCode(e.target.value.toUpperCase());
                      setError('');
                    }}
                    maxLength={6}
                    placeholder="ABC123"
                    className={`w-full px-4 py-4 border rounded-lg text-center text-2xl font-bold tracking-widest ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'border-gray-300'}`}
                  />
                </div>

                {error && (
                  <div className="bg-red-100 border border-red-400 text-red-800 px-4 py-3 rounded mb-4 text-sm">
                    {error}
                  </div>
                )}

                <button 
                  onClick={joinMatch} 
                  disabled={inputCode.length !== 6}
                  className="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white py-4 rounded-xl font-bold text-lg shadow-lg"
                >
                  {t.connect}
                </button>
              </div>
            </div>
          </div>
        );
      }

      // GAME SCREEN - This is your original app with multiplayer additions
      return (
        <div className={`min-h-screen pb-20 ${darkMode ? 'bg-gray-900' : 'bg-gradient-to-br from-blue-50 to-blue-100'}`}>
          <audio ref={audioRefs.homeGoal} src="homeGoal.mp3" />
          <audio ref={audioRefs.awayGoal} src="awayGoal.mp3" />
          <audio ref={audioRefs.homePenalty} src="homePenalty.mp3" />
          <audio ref={audioRefs.awayPenalty} src="awayPenalty.mp3" />
          <audio ref={audioRefs.intro} src="intro.mp3" />

          <div className={`${darkMode ? 'bg-gray-800 border-b border-gray-700' : 'bg-gradient-to-r from-blue-600 to-blue-800'} text-white p-4 shadow-lg sticky top-0 z-50`}>
            <div className="max-w-6xl mx-auto">
              {isMultiplayer && (
                <div className="mb-3 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    {!matchEnded && <span className="flex items-center gap-2 bg-red-500 px-3 py-1 rounded-full text-sm font-bold animate-pulse">
                      <span className="w-2 h-2 bg-white rounded-full"></span>
                      {t.liveMatch}
                    </span>}
                    {matchEnded && <span className="bg-gray-500 px-3 py-1 rounded-full text-sm font-bold">
                      {t.matchEnded}
                    </span>}
                    <span className="text-sm">üë• {connectedUsers} {t.connected}</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <button 
                      onClick={copyMatchCode}
                      className={`${darkMode ? 'bg-gray-700' : 'bg-white bg-opacity-20'} px-3 py-1 rounded font-mono font-bold`}
                    >
                      {matchCode} üìã
                    </button>
                    {!matchEnded && (
                      <button 
                        onClick={endMatch}
                        className="bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-sm font-semibold"
                      >
                        {t.endMatch}
                      </button>
                    )}
                  </div>
                </div>
              )}

              <div className="flex justify-between items-center mb-3">
                <div className="flex gap-2 items-center">
                  <span className="text-sm font-medium">{t.period}:</span>
                  {[1, 2, 3].map(p => (
                    <button 
                      key={p} 
                      onClick={() => {
                        setCurrentPeriod(p);
                        if (isMultiplayer && matchRef.current && !matchEnded) {
                          matchRef.current.update({ currentPeriod: p });
                        }
                      }} 
                      className={`px-3 py-1 rounded font-bold ${currentPeriod === p ? 'bg-yellow-400 text-blue-900' : darkMode ? 'bg-gray-700' : 'bg-white bg-opacity-20'}`}
                      disabled={matchEnded}
                    >
                      {p}
                    </button>
                  ))}
                </div>
                <div className="flex gap-2">
                  <button onClick={() => setStatsCollapsed(!statsCollapsed)} className={`${darkMode ? 'bg-gray-700' : 'bg-white bg-opacity-20'} px-3 py-1 rounded text-sm`}>
                    {statsCollapsed ? '‚ñº' : '‚ñ≤'}
                  </button>
                  <button onClick={() => setShowSettings(!showSettings)} className={`${darkMode ? 'bg-gray-700' : 'bg-white bg-opacity-20'} px-3 py-1 rounded text-sm`}>‚öôÔ∏è {t.settings}</button>
                </div>
              </div>

              {showSettings && (
                <div className={`${darkMode ? 'bg-gray-700 text-white' : 'bg-white text-gray-800'} rounded-lg p-4 mb-4`}>
                  <div className="flex justify-between items-center mb-3">
                    <h3 className="font-bold">{t.settings}</h3>
                    <button onClick={() => setShowSettings(false)} className={`${darkMode ? 'text-gray-400' : 'text-gray-500'} text-2xl`}>√ó</button>
                  </div>
                  <div className="space-y-3">
                    <div>
                      <label className="block text-sm mb-1">{t.homeTeam}</label>
                      <div className="flex gap-2">
                        <input 
                          type="text" 
                          value={homeName} 
                          onChange={(e) => {
                            setHomeName(e.target.value);
                            if (isMultiplayer && matchRef.current && !matchEnded) {
                              matchRef.current.update({ homeName: e.target.value });
                            }
                          }} 
                          className={`flex-1 px-3 py-2 border rounded ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : ''}`}
                          disabled={matchEnded}
                        />
                        <button onClick={() => setHomeName('')} className={`px-3 py-2 rounded text-sm ${darkMode ? 'bg-gray-600' : 'bg-gray-200'}`} disabled={matchEnded}>{t.clear}</button>
                      </div>
                    </div>
                    <div>
                      <label className="block text-sm mb-1">{t.awayTeam}</label>
                      <div className="flex gap-2">
                        <input 
                          type="text" 
                          value={awayName} 
                          onChange={(e) => {
                            setAwayName(e.target.value);
                            if (isMultiplayer && matchRef.current && !matchEnded) {
                              matchRef.current.update({ awayName: e.target.value });
                            }
                          }} 
                          className={`flex-1 px-3 py-2 border rounded ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : ''}`}
                          disabled={matchEnded}
                        />
                        <button onClick={() => setAwayName('')} className={`px-3 py-2 rounded text-sm ${darkMode ? 'bg-gray-600' : 'bg-gray-200'}`} disabled={matchEnded}>{t.clear}</button>
                      </div>
                    </div>
                    <label className="flex items-center justify-between">
                      <span>{t.swapSides}</span>
                      <input 
                        type="checkbox" 
                        checked={sidesSwapped} 
                        onChange={(e) => {
                          setSidesSwapped(e.target.checked);
                          if (isMultiplayer && matchRef.current && !matchEnded) {
                            matchRef.current.update({ sidesSwapped: e.target.checked });
                          }
                        }} 
                        className="w-5 h-5"
                        disabled={matchEnded}
                      />
                    </label>
                    <label className="flex items-center justify-between pt-2 border-t">
                      <span>{t.darkMode}</span>
                      <input type="checkbox" checked={darkMode} onChange={(e) => setDarkMode(e.target.checked)} className="w-5 h-5" />
                    </label>
                    <label className="flex items-center justify-between pt-2 border-t">
                      <span>{t.keepScreenOn}</span>
                      <input type="checkbox" checked={keepScreenOn} onChange={(e) => setKeepScreenOn(e.target.checked)} className="w-5 h-5" />
                    </label>
                    <label className="flex items-center justify-between pt-2 border-t">
                      <span>{t.language}</span>
                      <select value={language} onChange={(e) => setLanguage(e.target.value)} className={`px-3 py-2 rounded ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'border'}`}>
                        <option value="en">English</option>
                        <option value="sv">Svenska</option>
                      </select>
                    </label>
                    <div className="pt-2 border-t">
                      <label className="block text-sm mb-1">{t.spotifyPlaylistUrl}</label>
                      <div className="flex gap-2">
                        <input 
                          type="text" 
                          value={spotifyPlaylist} 
                          onChange={(e) => {
                            setSpotifyPlaylist(e.target.value);
                            setSpotifyLoaded(false);
                          }} 
                          placeholder="https://open.spotify.com/playlist/..." 
                          className={`flex-1 px-3 py-2 border rounded text-sm ${darkMode ? 'bg-gray-800 border-gray-600 text-white' : ''}`} 
                        />
                        <button 
                          onClick={() => {
                            setSpotifyPlaylist('https://open.spotify.com/playlist/3HunXm4QT4dxcOz6eAljak?si=mKiXLeNMQM6ioJivpWP-EQ&pi=lAZXLD_QSPmpq');
                            setSpotifyLoaded(false);
                          }} 
                          className={`px-3 py-2 rounded text-sm whitespace-nowrap ${darkMode ? 'bg-gray-600' : 'bg-gray-200'}`}
                        >
                          {t.restore}
                        </button>
                      </div>
                    </div>
                    {isMultiplayer && (
                      <div className="pt-2 border-t">
                        <button 
                          onClick={leaveMultiplayerMatch}
                          className="w-full bg-red-500 hover:bg-red-600 text-white py-2 rounded text-sm font-semibold"
                        >
                          Leave Multiplayer Match
                        </button>
                      </div>
                    )}
                  </div>
                </div>
              )}

              <div className="grid grid-cols-2 gap-4 mb-3">
                {[
                  { name: sidesSwapped ? awayName : homeName, score: sidesSwapped ? totals.awayScore : totals.homeScore, saves: sidesSwapped ? totals.awaySaves : totals.homeSaves, team: sidesSwapped ? 'away' : 'home', oppScore: sidesSwapped ? totals.homeScore : totals.awayScore, oppShots: sidesSwapped ? (totals.homeSaves + totals.awayScore) : (totals.awaySaves + totals.homeScore) },
                  { name: sidesSwapped ? homeName : awayName, score: sidesSwapped ? totals.homeScore : totals.awayScore, saves: sidesSwapped ? totals.homeSaves : totals.awaySaves, team: sidesSwapped ? 'home' : 'away', oppScore: sidesSwapped ? totals.awayScore : totals.homeScore, oppShots: sidesSwapped ? (totals.awaySaves + totals.homeScore) : (totals.homeSaves + totals.awayScore) }
                ].map((tm, idx) => (
                  <div key={idx} className={`${darkMode ? 'bg-gray-700 border border-gray-600' : 'bg-white bg-opacity-10'} rounded-lg p-3`}>
                    <div className="text-sm font-semibold mb-2">{tm.name}</div>
                    <div className="flex items-center justify-between mb-3">
                      <div>
                        <div className="text-xs opacity-75">{t.goals}</div>
                        <div className={`text-3xl font-bold ${sparkleStats[`${tm.team}Score${currentPeriod}`] ? 'sparkle' : ''}`}>{tm.score}</div>
                        {!statsCollapsed && (
                          <div className="text-xs opacity-75 mt-1">
                            {t.byPeriod}: (
                            {[1, 2, 3].map((p, i) => (
                              <span key={p} className={p === currentPeriod ? 'font-bold underline' : ''}>
                                {periodStats[p][tm.team + 'Score']}{i < 2 ? '-' : ''}
                              </span>
                            ))}
                            )
                          </div>
                        )}
                      </div>
                      <div className="flex gap-2">
                        <button onClick={() => updateStat(tm.team, 'Score', -1)} className="bg-red-500 bg-opacity-50 p-2 rounded" disabled={matchEnded}>‚àí</button>
                        <button onClick={() => updateStat(tm.team, 'Score', 1)} className="bg-green-500 bg-opacity-50 p-2 rounded" disabled={matchEnded}>+</button>
                      </div>
                    </div>
                    <div className={`pt-2 border-t ${darkMode ? 'border-gray-600' : 'border-white border-opacity-20'}`}>
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-xs">{t.saves}</span>
                        <div className="flex gap-2 items-center">
                          <button onClick={() => updateStat(tm.team, 'Saves', -1)} className="bg-white bg-opacity-20 p-1 rounded text-sm" disabled={matchEnded}>‚àí</button>
                          <span className={`text-lg font-bold w-8 text-center ${sparkleStats[`${tm.team}Saves${currentPeriod}`] ? 'sparkle' : ''}`}>{tm.saves}</span>
                          <button onClick={() => updateStat(tm.team, 'Saves', 1)} className="bg-white bg-opacity-20 p-1 rounded text-sm" disabled={matchEnded}>+</button>
                        </div>
                      </div>
                      {!statsCollapsed && (
                        <div className={`${darkMode ? 'bg-gray-600' : 'bg-white bg-opacity-10'} rounded p-2 text-xs text-center`}>
                          <div>{t.shotsFor}: {tm.oppShots} ({(periodStats[1][(tm.team === 'home' ? 'away' : 'home') + 'Saves'] + periodStats[1][tm.team + 'Score'])}-{(periodStats[2][(tm.team === 'home' ? 'away' : 'home') + 'Saves'] + periodStats[2][tm.team + 'Score'])}-{(periodStats[3][(tm.team === 'home' ? 'away' : 'home') + 'Saves'] + periodStats[3][tm.team + 'Score'])})</div>
                          <div>{t.shotsAgainst}: {tm.saves + tm.oppScore} ({(periodStats[1][tm.team + 'Saves'] + periodStats[1][(tm.team === 'home' ? 'away' : 'home') + 'Score'])}-{(periodStats[2][tm.team + 'Saves'] + periodStats[2][(tm.team === 'home' ? 'away' : 'home') + 'Score'])}-{(periodStats[3][tm.team + 'Saves'] + periodStats[3][(tm.team === 'home' ? 'away' : 'home') + 'Score'])})</div>
                          <div>{t.savePercent}: {calcSP(tm.saves, tm.oppScore)}% ({calcSP(periodStats[1][tm.team + 'Saves'], periodStats[1][(tm.team === 'home' ? 'away' : 'home') + 'Score'])}-{calcSP(periodStats[2][tm.team + 'Saves'], periodStats[2][(tm.team === 'home' ? 'away' : 'home') + 'Score'])}-{calcSP(periodStats[3][tm.team + 'Saves'], periodStats[3][(tm.team === 'home' ? 'away' : 'home') + 'Score'])})</div>
                        </div>
                      )}
                    </div>
                  </div>
                ))}
              </div>

              <div className="grid grid-cols-2 gap-3">
                <button onClick={resetCounters} className={`${darkMode ? 'bg-gray-700' : 'bg-white bg-opacity-10'} py-2 rounded text-sm`} disabled={matchEnded}>{t.resetAllStats}</button>
                <button onClick={() => setFocusMode('home')} className={`${darkMode ? 'bg-blue-700 hover:bg-blue-600' : 'bg-blue-500 bg-opacity-80 hover:bg-opacity-100'} py-2 rounded text-sm font-semibold`}>‚õ∂ {t.focusMode}</button>
              </div>
            </div>
          </div>

          <div className={`${darkMode ? 'bg-gray-800 border-b border-gray-700' : 'bg-white'} shadow-md sticky top-48 z-40`}>
            <div className="max-w-6xl mx-auto flex">
              {['soundboard', 'periods', 'referee'].map(tab => (
                <button key={tab} onClick={() => setActiveTab(tab)} className={`flex-1 py-3 font-semibold ${activeTab === tab ? (darkMode ? 'bg-blue-700 text-white' : 'bg-blue-600 text-white') : (darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-100 text-gray-600')}`}>
                  {tab === 'soundboard' ? t.soundboard : tab === 'periods' ? t.periodStats : t.refereeSignals}
                </button>
              ))}
            </div>
          </div>

          <div className="max-w-6xl mx-auto p-4">
            {activeTab === 'soundboard' && (
              <div>
                <div className="grid grid-cols-2 gap-3 mb-4">
                  <button onClick={toggleIntro} className={`${introPlaying ? 'bg-green-600' : (darkMode ? 'bg-gray-800' : 'bg-white')} ${darkMode ? 'border-gray-600 text-white' : 'border-gray-200'} border-2 p-4 rounded-lg shadow col-span-2`}>
                    <div className="text-2xl mb-1">{introPlaying ? '‚è∏Ô∏è' : 'üéµ'}</div>
                    <div className="font-semibold text-sm">{t.intro} {introPlaying ? '(Playing)' : ''}</div>
                  </button>
                  {[
                    { sound: 'homeGoal', label: homeName + ' ' + t.goal, icon: 'üö®' },
                    { sound: 'awayGoal', label: awayName + ' ' + t.goal, icon: 'üö®' },
                    { sound: 'homePenalty', label: homeName + ' ' + t.penalty, icon: 'üëÆ' },
                    { sound: 'awayPenalty', label: awayName + ' ' + t.penalty, icon: 'üëÆ' }
                  ].map(btn => (
                    <button key={btn.sound} onClick={() => playSound(btn.sound)} className={`${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-200'} border-2 p-4 rounded-lg shadow`}>
                      <div className="text-2xl mb-1">{btn.icon}</div>
                      <div className="font-semibold text-sm">{btn.label}</div>
                    </button>
                  ))}
                </div>
                <button onClick={stopAllSounds} className="w-full bg-red-500 text-white py-3 rounded-lg font-semibold">{t.stopAllSounds}</button>
                
                <div className={`${darkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white'} rounded-lg shadow p-4 mt-4`}>
                  <h3 className={`text-lg font-semibold mb-3 ${darkMode ? 'text-white' : ''}`}>üéµ Spotify Playlist</h3>
                  {!spotifyLoaded && !spotifyLoading ? (
                    <button 
                      onClick={handleLoadSpotify}
                      className="w-full bg-green-600 hover:bg-green-700 text-white py-8 rounded-lg font-semibold text-lg transition-colors"
                    >
                      ‚ñ∂ {language === 'en' ? 'Load Spotify Player' : 'Ladda Spotify-spelaren'}
                    </button>
                  ) : spotifyLoading ? (
                    <div className={`py-8 text-center ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                      <div className="animate-spin inline-block w-8 h-8 border-4 border-current border-t-transparent rounded-full mb-2"></div>
                      <div>{language === 'en' ? 'Loading...' : 'Laddar...'}</div>
                    </div>
                  ) : (
                    <div style={{opacity: 0, animation: 'fadeIn 0.5s ease-in forwards'}}>
                      {getSpotifyEmbedUrl(spotifyPlaylist) ? (
                        <iframe 
                          style={{borderRadius: '12px'}} 
                          src={getSpotifyEmbedUrl(spotifyPlaylist)} 
                          width="100%" 
                          height="352" 
                          frameBorder="0" 
                          allowFullScreen="" 
                          allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                          loading="lazy">
                        </iframe>
                      ) : (
                        <div className={`text-center py-8 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>
                          {language === 'en' ? 'Invalid Spotify URL. Please check Settings.' : 'Ogiltig Spotify-URL. Kontrollera inst√§llningarna.'}
                        </div>
                      )}
                    </div>
                  )}
                </div>
              </div>
            )}

            {activeTab === 'periods' && (
              <div>
                <h2 className={`text-2xl font-bold mb-4 ${darkMode ? 'text-white' : ''}`}>{t.periodStats}</h2>
                {[1, 2, 3].map(p => {
                  const ps = periodStats[p];
                  return (
                    <div key={p} className={`${darkMode ? 'bg-gray-800 border border-gray-700' : 'bg-white'} rounded-lg shadow p-4 mb-4`}>
                      <div className="flex justify-between items-center mb-3">
                        <h3 className={`text-xl font-bold ${darkMode ? 'text-white' : ''}`}>{t.period} {p}</h3>
                        {currentPeriod === p && <span className="bg-yellow-400 text-blue-900 px-3 py-1 rounded text-sm font-bold">Current</span>}
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        {[
                          { name: homeName, score: ps.homeScore, saves: ps.homeSaves, shotsFor: ps.awaySaves + ps.homeScore, shotsAgainst: ps.homeSaves + ps.awayScore, oppScore: ps.awayScore, color: darkMode ? 'bg-blue-900 bg-opacity-30 border-blue-700' : 'bg-blue-50' },
                          { name: awayName, score: ps.awayScore, saves: ps.awaySaves, shotsFor: ps.homeSaves + ps.awayScore, shotsAgainst: ps.awaySaves + ps.homeScore, oppScore: ps.homeScore, color: darkMode ? 'bg-red-900 bg-opacity-30 border-red-700' : 'bg-red-50' }
                        ].map((tm, i) => (
                          <div key={i} className={`${tm.color} ${darkMode ? 'border' : ''} rounded p-3`}>
                            <div className={`font-semibold mb-2 ${darkMode ? 'text-white' : ''}`}>{tm.name}</div>
                            <div className={`text-sm space-y-1 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                              <div className="flex justify-between"><span>{t.goals}:</span><span className="font-bold">{tm.score}</span></div>
                              <div className="flex justify-between"><span>{t.shotsFor}:</span><span className="font-bold">{tm.shotsFor}</span></div>
                              <div className="flex justify-between"><span>{t.saves}:</span><span className="font-bold">{tm.saves}</span></div>
                              <div className="flex justify-between"><span>{t.shotsAgainst}:</span><span className="font-bold">{tm.shotsAgainst}</span></div>
                              <div className="flex justify-between border-t pt-1"><span>{t.savePercent}:</span><span className="font-bold">{calcSP(tm.saves, tm.oppScore)}%</span></div>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  );
                })}
                <div className={`${darkMode ? 'bg-gradient-to-r from-gray-800 to-gray-700 border border-gray-600' : 'bg-gradient-to-r from-blue-600 to-blue-800'} text-white rounded-lg shadow-lg p-6`}>
                  <h3 className="text-2xl font-bold text-center mb-4">{t.final}</h3>
                  <div className="flex justify-center gap-8 text-center">
                    <div><div className="text-sm mb-1">{homeName}</div><div className="text-5xl font-bold">{totals.homeScore}</div></div>
                    <div className="text-3xl">-</div>
                    <div><div className="text-sm mb-1">{awayName}</div><div className="text-5xl font-bold">{totals.awayScore}</div></div>
                  </div>
                </div>
                <div className="grid grid-cols-2 gap-3 mt-4">
                  <button onClick={copyStats} className={`${darkMode ? 'bg-gray-800 border-gray-600 text-white' : 'bg-white border-gray-200'} border-2 py-3 rounded-lg font-semibold`}>üìã {t.copyStats}</button>
                  <button onClick={shareStats} className="bg-blue-600 text-white py-3 rounded-lg font-semibold">üì§ {t.share}</button>
                </div>
              </div>
            )}

            {activeTab === 'referee' && (
              <div>
                <h2 className={`text-2xl font-bold mb-4 ${darkMode ? 'text-white' : ''}`}>{t.refereeSignals}</h2>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {refSigs.map((sig, i) => (
                    <div key={i} className={`${sig.color} border-2 rounded-lg p-6 shadow`}>
                      <h3 className="text-xl font-bold mb-2">{sig.name}</h3>
                      <p className="text-gray-700">{sig.description}</p>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    ReactDOM.render(<JuniorLeagueApp />, document.getElementById('root'));
  </script>
</body>
</html>
